language: cpp

cache:
  directories:
    - cache

# env:
#   global:
#    # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
#    #   via the "travis encrypt" command using the project repo's public key
#    - secure: "Ncn6/msd5oa9PiMYS5y3bpqbcqnB9Wwr7UIEtDS6fd1X01sk7aWF267kMNq8ijosJtk1P4vjKmZomfhTyQgILV6UkNkSDae5NOc39XM9yoysxc6LHTnF8/E5wXgbV1oDJR9kenrBzX49ZRJxwYa9WgXsGz4AiDyUB9eMy48eomnyNXG/SkZBbPmxaI0zSCACWH0VMHwvxHOHnaXHMOuQDVN+oxP4gEdQ/Cz2P0QJl1TvE5hpYB9fW/yItcdgL7sVkiFXbkZh5l3s52fGEN339e9CEEEEqnEUmFAzq0nsZNKZqh+ivh4Ga2qJa+btLGkEYyNQyKpOjy21Wx8UKY6uT5ZVxdSK943dbn0+v2nr0K++Hu2mRoq3btMfza5PZGQrK/XdOgathqxMoqSlKKXNo5qQoHfyjRLUscaZPsF/kWfnUoRGA90Eg6RLq59gsKkQjSJ0cWJ6Czt2txJZvmAZn51thBMJ3QW88+taDXkSVXsXkrdPjGPrwUt+okhvXJK5+PeSa+Fb4CJUiijOAg9Sew+WDJdsP9d0gVtEncXiVdAgdUFZ9wbyKCrjPisKxZWzzMDr+7tT3MQmg8FagPMkm5PW9Q+Ewof2VLjxffX+PhHcWvUrVqe8KBEVuJNs4SYG0ETsvp0+y8tyh5o+zAmc8fKsuYmEDNJ727rjrTfA56A="

jobs:
  include:
    - stage: "Warm cache"
      name: "Warm cache (Linux)"
      os: linux
      script: ci/linux-warmcache.sh

    - stage: "Warm cache"
      name: "Warm cache (Windows 32-bit)"
      os: windows
      env:
        - PLATFORM: win32
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017
      script: ci/windows-warmcache.sh

    - stage: "Warm cache"
      name: "Warm cache (Windows 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-warmcache.sh

    - stage: "Libraries"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-libcomp.sh

    - stage: "Channel"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-channel.sh

    # - stage: "Build"
    #   name: "Linux (Clang+Make)"
    #   os: linux
    #   dist: trusty
    #   sudo: required
    #   compiler: clang
    #   env:
    #     - COMPILER_CC=clang
    #     - COMPILER_CXX=clang++
    #     - CMAKE_GENERATOR='Unix Makefiles'
    #   before_install: ci/linux-before_install.sh
    #   script: ci/linux-build.sh

    # - stage: "Build"
    #   name: "Linux (Clang+Ninja)"
    #   os: linux
    #   dist: trusty
    #   sudo: required
    #   compiler: clang
    #   env:
    #     - COMPILER_CC=clang
    #     - COMPILER_CXX=clang++
    #     - CMAKE_GENERATOR=Ninja
    #   before_install: ci/linux-before_install.sh
    #   script: ci/linux-build.sh

    # - stage: "Build"
    #   name: "Linux (GCC5+Make)"
    #   os: linux
    #   dist: trusty
    #   sudo: required
    #   compiler: gcc
    #   addons:
    #     apt:
    #       sources:
    #         - ubuntu-toolchain-r-test
    #       packages:
    #         - g++-5
    #   env:
    #     - COMPILER_CC=gcc-5
    #     - COMPILER_CXX=g++-5
    #     - CMAKE_GENERATOR='Unix Makefiles'
    #   before_install: ci/linux-before_install.sh
    #   script: ci/linux-build.sh

    - stage: "Build"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-build.sh

    - stage: "Deploy"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
        - secure: "VfcdtDHRQTm6vqLyuqNY96GmXN465PONc5hA5X6xbfNRKGpzaRw6dYfuBLHPgwJncw9SYsOW7Ssf8kq6E8Uc3B6UoqRW7n04V1EypDRTYCd78oiCM/uN8mhPf1MnDpv1Zd5vxPrewPi7wAkX6wpbiVN/R3yuv2pnii1e3VTqE2Hdlbw+1bU0wuy8WbifZ8vyganS45r4hcrNrbtU2iaSHY4WGmQjMpyX//CXF2d7kCqW5ThfX+SpuFF/R8rBgV3H3tKeXlSoKc+fmr7kMtnyGki6wM3hKao7D0zSM+lDr3XNC4voXGfG6c6Bba4geAE4UdLCP+aouI9HtJLSMlwlYnbYHyPFNgEZnYORyJEMx3uQcoNTlgIlYKPd6Q1dpRWgBqeYUI/VZGix51pNy3lJFesI2Asd6/evZTllQiMSZdtx5aCvDtgT6H7QaI4RfspxxSAuvJ0HvqE4Q7IEze4kYzoldS96dzcVpQGlYAGihAOrJW1ZVc9OZr5UlsLUHQ7K9XOKRYAW76pdyJTOVM3wFnZfUMCfKdPmiiVQEfw8EPUX04uBJvJcozwlR3GaEl8VvDZ/Vmde1ncfOLtiybPBWtMD09ZEC9NNrNGrXI98NFTu6ZKMXKkcKLaQPrAQhr5A8HOky96KqZKNvTHDa4yUsV9CDkIsBFLE298sGj59fvw="
      before_install:
        - cd ci && gem install dropbox-deployment-1.0.0.gem && cd ..
      script: ci/linux-deploy.sh
      after_success:
        - dropbox-deployment -u /comp_hack -a deploy
