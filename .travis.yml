language: cpp

cache:
  directories:
    - cache

env:
  global:
    # Dropbox for comphack/comp_hack (DROPBOX_OAUTH_BEARER_COMPHACK_COMP_HACK)
    - secure: "IUJVH79CrfF1QdV70ydGoKFnf6u7SeLD8Q1jjzKUecirS2gg/lU4ddlYJwjRFuj9E5eOOkjunPuSnm8OPWvPgriSZFUgUVnEX6yAV/91nabP3UqPcOC3wEvfEXcCyHBBEezgYpoaZII8cpAXOEzQyVmAoHFfKVYX7bPE9EL5yIibKScZ8co9M887ouYErhCcssLPvg+xCYTR/QgiX9ymacBaNy0cUvVX+0ne3PetBbEtC9AgWFD0eJEBz7mXo159sZcFFSeUvRz2ajArNvuQSogCiYI886RNIHFcFQhJG1W3PW0KiBubvoXEzaaNE6CdNtHY4ginskrXPNd1CXYrgBYO6luNAAigthW4+VYJvHHsMvB3lH9jofBK47I7qWxVt1cVSsLAuRQ/EpwxILjIhGPnh47oGhAmza6uKa9850zEAqjJ8uiwjI6SPCg+xvsxIgfesHtFMIOUaT7oo4ihCouBL3f5vBJGm+08EoJpwY1ET5cQUn0gv7t5/4YaMkxdz1QtwVDAPT/KvEc5SeMINrdQfWgue2J5GSeP6Eu+rDhOgrhGO99g+y55o0UgxzFNHn9ZO07J1kYDbWDuLFiANmTHttFvLFby1ryTSVaOmzKxl5y4bd9PO1VKK++Qemi9eX++JhjUq0GLh5V9PGGvI+1pxVHCjtzX11126Csqr8Q="
    # Dropbox for compomega/comp_hack (DROPBOX_OAUTH_BEARER_COMPOMEGA_COMP_HACK)
    - secure: "OZpG+eY2BZa6txGleVC8m5k9iFmW/GGRYmnR50QgFCuFCu4lDK9BIGnuChYQXisF0E+ZP2jBLXFepM5H/js5Z4z/XYbCNI7Gu1wBpJxxDhbhyzmnMj1Y/hWDnQ3o+4p8uI9WjLBEmPGUNMpaKYWbtG4hcLxcg+6kwnnMIIO1nuwZHetMuhWrCRA1EDsvaS3++PrScuA9Kli+Yd8KffjQZWLDj90kKazvymVmK14Tfm37hdV7pP1xTGMFK+zrkEmFqbTF/oOSZfUG+W4jbKnFGMAXIJHuLqaYkRASOGMSW/mfX+Wrc4HdDfuc3MrGy49bS4HjRaVeb3BxAWmGGNGK5c9lNNsTTn1uZ5r0FytGbCJ8Idq9XX+cmRzn9nsjGliMZ3U0qw9QAJLhAfFMyx23v3Cmb3iqkR3JLCakPv7ZmEQW9fRJoJvKhqGyRfizF07lKTRIH/3k4DMc140ESpVDmybDBoqI7ve1qZvVtjhQKlMuvbIxC8//Pf4Mov6MYGdriXmF1ZTL1Og0jSsThZJANqMckJoLyqaGO4Wt/7lAtqkepVLB2IsFwgBc21tqTVREQP/QEYK2Jnx7RccatxvKP6199uT9GczZ/bZv5k5yEg110lvjitlaNvO3Uz4QIMPmG+FRpwh5l2FV9mQaeOyI3McoFMAy3QloNHkFzYBQ0nU="

jobs:
  include:
    # - stage: "Warm cache"
    #   name: "Warm cache (Linux)"
    #   os: linux
    #   script: ci/linux-warmcache.sh

    # - stage: "Warm cache"
    #   name: "Warm cache (Windows 32-bit)"
    #   os: windows
    #   env:
    #     - PLATFORM: win32
    #     - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017
    #   script: ci/windows-warmcache.sh

    - stage: "Warm cache"
      name: "Warm cache (Windows 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-warmcache.sh

    - stage: "Libraries"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-libcomp.sh

    - stage: "Channel"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-channel.sh

    # - stage: "Build"
    #   name: "Linux (Clang+Make)"
    #   os: linux
    #   dist: trusty
    #   sudo: required
    #   compiler: clang
    #   env:
    #     - COMPILER_CC=clang
    #     - COMPILER_CXX=clang++
    #     - CMAKE_GENERATOR='Unix Makefiles'
    #   before_install: ci/linux-before_install.sh
    #   script: ci/linux-build.sh

    # - stage: "Build"
    #   name: "Linux (Clang+Ninja)"
    #   os: linux
    #   dist: trusty
    #   sudo: required
    #   compiler: clang
    #   env:
    #     - COMPILER_CC=clang
    #     - COMPILER_CXX=clang++
    #     - CMAKE_GENERATOR=Ninja
    #   before_install: ci/linux-before_install.sh
    #   script: ci/linux-build.sh

    # - stage: "Build"
    #   name: "Linux (GCC5+Make)"
    #   os: linux
    #   dist: trusty
    #   sudo: required
    #   compiler: gcc
    #   addons:
    #     apt:
    #       sources:
    #         - ubuntu-toolchain-r-test
    #       packages:
    #         - g++-5
    #   env:
    #     - COMPILER_CC=gcc-5
    #     - COMPILER_CXX=g++-5
    #     - CMAKE_GENERATOR='Unix Makefiles'
    #   before_install: ci/linux-before_install.sh
    #   script: ci/linux-build.sh

    - stage: "Build"
      name: "Windows (VS2017 64-bit)"
      os: windows
      env:
        - PLATFORM: win64
        - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
      script: ci/windows-build.sh

    # - stage: "Deploy"
    #   name: "Windows (VS2017 64-bit)"
    #   os: windows
    #   env:
    #     - PLATFORM: win64
    #     - QT5_BASE_DIR: C:/Qt/5.12.3/msvc2017_64
    #   before_install:
    #     - cd ci && gem install dropbox-deployment-1.0.0.gem && cd ..
    #   script: ci/linux-deploy.sh
    #   after_success:
    #     - dropbox-deployment -u /comp_hack -a deploy
